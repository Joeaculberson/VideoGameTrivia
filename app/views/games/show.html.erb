<head>
  <script>
      /*
       Description:
       This script contains the functions to load the winning wheel image and do the rotation of it.
       By Douglas McKechie @ www.dougtesting.net
       */
      var canvasId         = "myDrawingCanvas";   // Id of the canvas element on the page the wheel is to be rendered on.
      var wheelImageName   = "prizewheel.png";	// File name of the image for the wheel.
      var spinButtonImgOn  = "spin_on.png";		// Name / path to the images for the spin button.
      var spinButtonImgOff = "spin_off.png";
      var theSpeed         = 20; 		 // Controls how often the spin function is called (is miliseconds value for animation timer).
      var pointerAngle     = 0;  	 	 // The angle / location around the wheel where the pointer indicaing the prize is located. Can be any value you like, 0 is top (12 oclock) 180 is bottom (6 o'clock) etc.
      var doPrizeDetection = true; 	 // Set to true if you want the code to detect the prize the user has won when the spinning has stopped. Prizes need to be specified in the prizes array.
      var spinMode         = "random"; // Values can be: random, determinedAngle, determinedPrize.
      var determinedGetUrl = "";  	 // Set to URL of the server-side process to load via ajax when spinMode is determinedAngle or determinedPrize.

      var prizes = new Array();
      prizes[0] = {"name" : "adventure", "startAngle" : 0,   "endAngle" : 51.42857142857143};  // Note how prize end angle is 1 less than start angle of next prize so no overlap.
      prizes[1] = {"name" : "arcade", "startAngle" : 51.42857142857144,  "endAngle" : 102.85714285714286};
      prizes[2] = {"name" : "fps", "startAngle" : 102.85714285714286,  "endAngle" : 154.28571428571429};
      prizes[3] = {"name" : "racing", "startAngle" : 154.2857142857143, "endAngle" : 205.71428571428572};
      prizes[4] = {"name" : "role-playing", "startAngle" : 205.71428571428573, "endAngle" : 257.14285714285715};
      prizes[5] = {"name" : "challenge", "startAngle" : 257.14285714285716, "endAngle" : 308.57142857142858};
      prizes[6] = {"name" : "action", "startAngle" : 308.57142857142859, "endAngle" : 360};

      // --------------------------------
      // VARIABLES THAT YOU DON'T NEED TO / SHOULD NOT CHANGE...
      var surface;		   // Set to the drawing canvas object in the begin function.
      var wheel;			   // The image of the face of the wheel is loaded in to an image object assigned to this var.
      var angle 		 = 0;  // Populated with angle figured out by the threshold code in the spin function. You don't need to set this here.
      var targetAngle  = 0;  // Set before spinning of the wheel begins by startSpin function depending on spinMode.
      var currentAngle = 0;  // Used during the spin to keep track of current angle.
      var power        = 0;  // Set when the power is selected. 1 for low, 2 for med, 3 for high.

      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = ajaxCallback;
      var randomLastThreshold = 150;
      var spinTimer;
      var wheelState = 'reset';

      function begin()
      {
          surface = document.getElementById(canvasId);
          if (surface.getContext)
          {
              wheel = new Image();
              wheel.onload = initialDraw;		// Once the image is loaded from file this function is called to draw the image in its starting position.
              wheel.src = wheelImageName;
          }
      }

      function initialDraw(e)
      {
          var surfaceContext = surface.getContext('2d');
          surfaceContext.drawImage(wheel, 0, 0);
      }

      function startSpin(determinedValue)
      {
          var stopAngle = undefined;
          if (spinMode == "random")
          {
              stopAngle = Math.floor(Math.random() * 360);
          }
          else if (spinMode == "determinedAngle")
          {
              if (typeof(determinedValue) === 'undefined')
              {
                  if (determinedGetUrl)
                  {
                      xhr.open('GET', determinedGetUrl, true);
                      xhr.send('');
                  }
              }
              else
              {
                  stopAngle = determinedValue;
              }
          }
          else if (spinMode == "determinedPrize")
          {
              if (typeof(determinedValue) === 'undefined')
              {
                  if (determinedGetUrl)
                  {
                      xhr.open('GET', determinedGetUrl, true);
                      xhr.send('');
                  }
              }
              else
              {
                  stopAngle = Math.floor(prizes[determinedValue]['startAngle'] + (Math.random() * (prizes[determinedValue]['endAngle'] - prizes[determinedValue]['startAngle'])));
              }
          }

          if ((typeof(stopAngle) !== 'undefined') && (wheelState == 'reset') && (power))
          {
              stopAngle = (360 + pointerAngle) - stopAngle;
              targetAngle = (360 * (power * 6) + stopAngle);
              randomLastThreshold = Math.floor(90 + (Math.random() * 90));
              wheelState = 'spinning';
              doSpin();
          }
      }

      function ajaxCallback()
      {
          if (xhr.readyState < 4)
          {
              return;
          }

          if (xhr.status !== 200)
          {
              return;
          }
          startSpin(xhr.responseText);
      }

      function doSpin()
      {
          var surfaceContext = surface.getContext('2d');
          surfaceContext.save();
          surfaceContext.translate(wheel.width * 0.5, wheel.height * 0.5);
          surfaceContext.rotate(DegToRad(currentAngle));
          surfaceContext.translate(-wheel.width * 0.5, -wheel.height * 0.5);
          surfaceContext.drawImage(wheel, 0, 0);
          surfaceContext.restore();
          currentAngle += angle;
          if (currentAngle < targetAngle)
          {
              var angleRemaining = (targetAngle - currentAngle);
              if (angleRemaining > 6480)
                  angle = 55;
              else if (angleRemaining > 5000)		// NOTE: you can adjust as desired to alter the slowdown, making the stopping more gradual or more sudden.
                  angle = 45;						// If you alter the forumla used to work out the targetAngle you may need to alter these.
              else if (angleRemaining > 4000)
                  angle = 30;
              else if (angleRemaining > 2500)
                  angle = 25;
              else if (angleRemaining > 1800)
                  angle = 15;
              else if (angleRemaining > 900)
                  angle = 11.25;
              else if (angleRemaining > 400)
                  angle = 7.5;
              else if (angleRemaining > 220)					// You might want to randomize the lower threhold numbers here to be between a range
                  angle = 3.80;								// otherwise if always within last 150 when the speed is set to 1 degree the user can
              else if (angleRemaining > randomLastThreshold)	// tell what prize they will win before the wheel stops after playing the wheel a few times.
                  angle = 1.90;								// This variable is set in the startSpin function. Up to you if you want to randomise the others.
              else
                  angle = 1;		// Last angle should be 1 so no risk of the wheel overshooting target if using preDetermined spin mode
              // (only a problem if pre-Determined location is near edge of a segment).

              spinTimer = setTimeout("doSpin()", theSpeed);
          }
          else
          {
              wheelState = 'stopped';

              // If to do prize dection then work out the prize pointed to.
              if ((doPrizeDetection) && (prizes))
              {
                  // Get how many times the wheel has rotated past 360 degrees.
                  var times360 = Math.floor(currentAngle / 360);
                  var rawAngle = (currentAngle - (360 * times360));
                  var relativeAngle =  Math.floor(pointerAngle - rawAngle);

                  if (relativeAngle < 0)
                      relativeAngle = 360 - Math.abs(relativeAngle);

                  for (x = 0; x < (prizes.length); x ++)
                  {
                      if ((relativeAngle >= prizes[x]['startAngle']) && (relativeAngle <= prizes[x]['endAngle']))
                      {
                          //alert("You won " + prizes[x]['name'] + "!\nClick 'Play Again' to have another go.");
                          $.post('/spun_category',{spun_category: prizes[x]['name']});
                          break;
                      }
                  }
              }

              // ADD YOUR OWN CODE HERE.
              // If no prize detection then up to you to do whatever you want when the spinning has stopped.
          }
      }

      function DegToRad(d)
      {
          return d * 0.0174532925199432957;
      }

      function powerSelected(powerLevel)
      {
          if (wheelState == 'reset')
          {
              power = powerLevel;
          }
      }
  </script>
  <style>
      .row {
          position: relative;
      }
      .buttonBox {
          position: absolute;
          bottom:0;
          right:0;
      }
  </style>
</head>

<div class="text-center">
  <p>
    <strong>Round:</strong>
    <%= @game.round %>
  </p>
</div>

<div class="container round-edges">
  <div class="row">
    <div class="col-xs-1">
      <div id="face-wrapper">
        <% if current_user.image && !current_user.hide_picture %>
            <%= link_to image_tag(current_user.image, :class => 'img-circle face'), '#', 'data-toggle' => 'modal', 'data-target' => '#statsModal' %>
        <% else %>
            <%= link_to image_tag("default_profile.png", :class => 'img-circle face'), '#', 'data-toggle' => 'modal', 'data-target' => '#statsModal' %>
        <% end %>
      </div>
    </div>
    <div class="col-xs-5">
      <% if(current_user.hide_email) %>
      You - Level: <%= (current_user.level / 10) + 1 %>
      <% else %>
          <%= @game.user_email %> - Level: <%= (current_user.level / 10) + 1 %>
      <% end %>
       </br>
      <img id="userActionImage" src='<%= image_url('greyscale/action.png') %>' width="50" height="50">
      <img id="userAdventureImage" src='<%= image_url('greyscale/adventure.png') %>' width="50" height="50">
      <img id="userArcadeImage" src='<%= image_url('greyscale/arcade.png') %>' width="50" height="50">
      <img id="userFpsImage" src='<%= image_url('greyscale/fps.png') %>' width="50" height="50">
      <img id="userRacingImage" src='<%= image_url('greyscale/racing.png') %>' width="50" height="50">
      <img id="userRolePlayingImage" src='<%= image_url('greyscale/role-playing.png') %>' width="50" height="50">
    </div>
    <div class="col-xs-5" style="border-left-style: dotted">
      <div class="pull-right">
        <% if(@current_opponent.hide_email) %>
            Opponent - Level: <%= (@current_opponent.level / 10) + 1 %>
        <% else %>
            <%= @game.opponent_user_email %> - Level: <%= (@current_opponent.level / 10) + 1 %>
        <% end %>
        </div>
      </br>
      <div class="pull-right">
        <img id="opponentRolePlayingImage" src='<%= image_url('greyscale/role-playing.png') %>' width="50" height="50">
        <img id="opponentRacingImage" src='<%= image_url('greyscale/racing.png') %>' width="50" height="50">
        <img id="opponentFpsImage" src='<%= image_url('greyscale/fps.png') %>' width="50" height="50">
        <img id="opponentArcadeImage" src='<%= image_url('greyscale/arcade.png') %>' width="50" height="50">
        <img id="opponentAdventureImage" src='<%= image_url('greyscale/adventure.png') %>' width="50" height="50">
        <img id="opponentActionImage" src='<%= image_url('greyscale/action.png') %>' width="50" height="50">
      </div>
    </div>
    <div class="col-xs-1">
      <div class="pull-right">
        <div id="face-wrapper">
          <% if @current_opponent.image && !@current_opponent.hide_picture%>
              <%= link_to image_tag(@current_opponent.image, :class => 'img-circle face'), '#', 'data-toggle' => 'modal', 'data-target' => '#opponentStatsModal' %>
          <% else %>
              <%= link_to image_tag("default_profile.png", :class => 'img-circle face'), '#', 'data-toggle' => 'modal', 'data-target' => '#opponentStatsModal' %>

          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

</br>

<div class="arrow-down"></div>

<div class="row text-center" onClick="startSpin();">
  <canvas class="the_canvas" id="myDrawingCanvas" width="300" height="300" >
    <p class="noCanvasMsg" align="center" >Sorry, your browser doesn't support canvas.<br />Please try another.</p>
  </canvas>
</div>


<div class="row text-center">
  <div class="col-xs-12">
    <img src='<%= image_url('triforce_meter/' + @game.user_meter.to_s + '.png') %>' width="150">
  </div>
  <div class="col-xs-4 buttonBox">
    <%= button_to 'Resign', resign_game_path, :class => 'btn btn-info btn-block', :method => :get%>
  </div>
</div>

<% if @game.user_pieces == "1 2 3 4 5 6" %>
    <% @game.is_game_over = true %>
    <% @game.save! %>
    <% @user = User.find_by(email: @game.user_email) %>
    <% @user.coins += 5 %>
    <% @user.save %>
    <div class="modal fade" id="wonModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Congratulations! You've won!</h4>
          </div>
          <img id="youWin" src='<%= image_url('win.gif') %>'>
          You win 5 coins! Total coins: <%= @user.coins %>
          <%= button_to 'Back to game select', games_path, :class => 'btn btn-info btn-lg btn-block', :method => :get %>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <script>
        $('#wonModal').modal({
            backdrop: 'static',
            keyboard: false
        });
        $(window).load(function () {
            $('#wonModal').modal('show')
        });
    </script>
<% end %>

<% if @game.user_meter == 3 %>
    <div class="modal fade" id="challengeModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Earn a piece!</h4>
          </div>
          <div class="modal-body row">
            <div role="tabpanel">

              <!-- Nav tabs -->
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                  <a href="#challenge" aria-controls="challenge" role="tab" data-toggle="tab">Challenge</a></li>
                <li role="presentation">
                  <a href="#stealAPiece" aria-controls="stealAPiece" role="tab" data-toggle="tab">Steal a Piece</a></li>
              </ul>

              <!-- Tab panes -->
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="challenge">
                  <div class="container col-md-12 text-center">
                    <div class="row">
                      <div class="col-md-3">
                        <img id="userActionImage" class="userActionImage" src='<%= image_url('greyscale/action.png') %>' width="50" height="50"></br>
                        Action
                      </div>
                      <div class="col-md-3">
                        <img id="userAdventureImage" class='userAdventureImage' src='<%= image_url('greyscale/adventure.png') %>' width="50" height="50"></br>
                        Adventure
                      </div>
                      <div class="col-md-3">
                        <img id="userArcadeImage" class='userArcadeImage' src='<%= image_url('greyscale/arcade.png') %>' width="50" height="50"></br>
                        Arcade
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <img id="userFpsImage" class='userFpsImage' src='<%= image_url('greyscale/fps.png') %>' width="50" height="50"></br>
                        Fps
                      </div>
                      <div class="col-md-3">
                        <img id="userRacingImage" class="userRacingImage" src='<%= image_url('greyscale/racing.png') %>' width="50" height="50"></br>
                        Racing
                      </div>
                      <div class="col-md-3">
                        <img id="userRolePlayingImage" class="userRolePlayingImage" src='<%= image_url('greyscale/role-playing.png') %>' width="50" height="50"></br>
                        Role-playing
                      </div>
                    </div>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="stealAPiece">
                  <div id="betChoiceTab" class="container col-md-12 text-center">
                    Piece to bet (Note: you cannot bet pieces your opponent already has)
                    <div class="row">
                      <div class="col-md-3">
                        <img id="userBetActionImage" class="userBetActionImage" src='<%= image_url('greyscale/action.png') %>' width="50" height="50"></br>
                        Action
                      </div>
                      <div class="col-md-3">
                        <img id="userBetAdventureImage" class='userBetAdventureImage' src='<%= image_url('greyscale/adventure.png') %>' width="50" height="50"></br>
                        Adventure
                      </div>
                      <div class="col-md-3">
                        <img id="userBetArcadeImage" class='userBetArcadeImage' src='<%= image_url('greyscale/arcade.png') %>' width="50" height="50"></br>
                        Arcade
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <img id="userBetFpsImage" class='userBetFpsImage' src='<%= image_url('greyscale/fps.png') %>' width="50" height="50"></br>
                        Fps
                      </div>
                      <div class="col-md-3">
                        <img id="userBetRacingImage" class="userBetRacingImage" src='<%= image_url('greyscale/racing.png') %>' width="50" height="50"></br>
                        Racing
                      </div>
                      <div class="col-md-3">
                        <img id="userBetRolePlayingImage" class="userBetRolePlayingImage" src='<%= image_url('greyscale/role-playing.png') %>' width="50" height="50"></br>
                        Role-playing
                      </div>
                    </div>
                  </div>

                  <div id="stealChoiceTab" class="container col-md-12 text-center">
                    Piece to steal (Note: you cannot steal pieces you already have)
                    <div class="row">
                      <div class="col-md-3">
                        <img id="opponentStealActionImage" class="opponentStealActionImage" src='<%= image_url('greyscale/action.png') %>' width="50" height="50"></br>
                        Action
                      </div>
                      <div class="col-md-3">
                        <img id="opponentStealAdventureImage" class='opponentStealAdventureImage' src='<%= image_url('greyscale/adventure.png') %>' width="50" height="50"></br>
                        Adventure
                      </div>
                      <div class="col-md-3">
                        <img id="opponentStealArcadeImage" class='opponentStealArcadeImage' src='<%= image_url('greyscale/arcade.png') %>' width="50" height="50"></br>
                        Arcade
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <img id="opponentStealFpsImage" class='opponentStealFpsImage' src='<%= image_url('greyscale/fps.png') %>' width="50" height="50"></br>
                        Fps
                      </div>
                      <div class="col-md-3">
                        <img id="opponentStealRacingImage" class="opponentStealRacingImage" src='<%= image_url('greyscale/racing.png') %>' width="50" height="50"></br>
                        Racing
                      </div>
                      <div class="col-md-3">
                        <img id="opponentStealRolePlayingImage" class="opponentStealRolePlayingImage" src='<%= image_url('greyscale/role-playing.png') %>' width="50" height="50"></br>
                        Role-playing
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <script>
        $('#challengeModal').modal({
            backdrop: 'static',
            keyboard: false
        });
        $(window).load(function () {
            $('#challengeModal').modal('show')
        });
    </script>
<% end %>

<script>
    $("#stealChoiceTab").hide();
    var piece_to_bet = "";
    <% if @game.user_pieces.split.include? '1' %>
    document.getElementById("userActionImage").src = '<%= image_url('icons/action.png')%>';
    $('img.userActionImage').attr("src", '<%= image_url('icons/action.png')%>');
        <% if !@game.opponent_pieces.split.include? '1' %>
            $('img.userBetActionImage').attr("src", '<%= image_url('icons/action.png')%>');
            $(function () {
                $("img.userBetActionImage").click(function () {
                    $(this).css('border', "solid 2px red");
                    $("#betChoiceTab").hide();
                    $("#stealChoiceTab").show();
                    piece_to_bet = 'action';
                });
            });
        <% end %>
    <% else %>
    $('img.userActionImage').click(function () {
        $.post('/chosen_category', {chosen_category: 'action' , type: 'challenge'});
    });
    <% end %>

    <% if @game.user_pieces.split.include? '2' %>
    document.getElementById("userAdventureImage").src = '<%= image_url('icons/adventure.png')%>';
    $('img.userAdventureImage').attr("src", '<%= image_url('icons/adventure.png')%>');

        <% if !@game.opponent_pieces.split.include? '2' %>
        $('img.userBetAdventureImage').attr("src", '<%= image_url('icons/adventure.png')%>');
        $(function () {
            $("img.userBetAdventureImage").click(function () {
                $(this).css('border', "solid 2px red");
                $("#betChoiceTab").hide();
                $("#stealChoiceTab").show();
                piece_to_bet = 'adventure';
            });
        });
        <% end %>
    <% else %>
    $("img.userAdventureImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'adventure', type: 'challenge'});
    });
    <% end %>

    <% if @game.user_pieces.split.include? '3' %>
    document.getElementById("userArcadeImage").src = '<%= image_url('icons/arcade.png')%>';
    $('img.userArcadeImage').attr("src", '<%= image_url('icons/arcade.png')%>');

    <% if !@game.opponent_pieces.split.include? '3' %>
        $('img.userBetArcadeImage').attr("src", '<%= image_url('icons/arcade.png')%>');
        $(function () {
            $("img.userBetArcadeImage").click(function () {
                $(this).css('border', "solid 2px red");
                $("#betChoiceTab").hide();
                $("#stealChoiceTab").show();
                piece_to_bet = 'arcade';
            });
        });
    <% end %>
    <% else %>
    $("img.userArcadeImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'arcade', type: 'challenge'});
    });
    <% end %>

    <% if @game.user_pieces.split.include? '4' %>
    document.getElementById("userFpsImage").src = '<%= image_url('icons/fps.png')%>';
    $('img.userFpsImage').attr("src", '<%= image_url('icons/fps.png')%>');

    <% if !@game.opponent_pieces.split.include? '4' %>
    $('img.userBetFpsImage').attr("src", '<%= image_url('icons/fps.png')%>');
    $(function () {
        $("img.userBetFpsImage").click(function () {
            $(this).css('border', "solid 2px red");
            $("#betChoiceTab").hide();
            $("#stealChoiceTab").show();
            piece_to_bet = 'fps';
        });
    });
    <% end %>
    <% else %>
    $("img.userFpsImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'fps', type: 'challenge'});
    });
    <% end %>

    <% if @game.user_pieces.split.include? '5' %>
    document.getElementById("userRacingImage").src = '<%= image_url('icons/racing.png')%>';
    $('img.userRacingImage').attr("src", '<%= image_url('icons/racing.png')%>');

    <% if !@game.opponent_pieces.split.include? '5' %>
    $('img.userBetRacingImage').attr("src", '<%= image_url('icons/racing.png')%>');
    $(function () {
        $("img.userBetRacingImage").click(function () {
            $(this).css('border', "solid 2px red");
            $("#betChoiceTab").hide();
            $("#stealChoiceTab").show();
            piece_to_bet = 'racing';
        });
    });
    <% end %>
    <% else %>
    $("img.userRacingImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'racing', type: 'challenge'});
    });
    <% end %>

    <% if @game.user_pieces.split.include? '6' %>
    document.getElementById("userRolePlayingImage").src = '<%= image_url('icons/role-playing.png')%>';
    $('img.userRolePlayingImage').attr("src", '<%= image_url('icons/role-playing.png')%>');

        <% if !@game.opponent_pieces.split.include? '6' %>
            $('img.userBetRolePlayingImage').attr("src", '<%= image_url('icons/role-playing.png')%>');
            $(function () {
                $("img.userBetRolePlayingImage").click(function () {
                    $(this).css('border', "solid 2px red");
                    $("#betChoiceTab").hide();
                    $("#stealChoiceTab").show();
                    piece_to_bet = 'role-playing';
                });
            });
        <% end %>

    <% else %>
        $("img.userRolePlayingImage").click(function () {
            $.post('/chosen_category', {chosen_category: 'role-playing', type: 'challenge'});
        });
    <% end %>

    <% if @game.opponent_pieces.split.include? '1' %>
    document.getElementById("opponentActionImage").src = '<%= image_url('icons/action.png')%>';
    $('img.opponentActionImage').attr("src", '<%= image_url('icons/action.png')%>');
        <% if !@game.user_pieces.split.include? '1' %>
            $('img.opponentStealActionImage').attr("src", '<%= image_url('icons/action.png')%>');
            $(function () {
                $("img.opponentStealActionImage").click(function () {
                    $.post('/steal_piece_settings', {chosen_category: 'action', bet_piece: piece_to_bet, type: 'steal'});
                });
            });
        <% end %>

    $("img.opponentActionImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'action'});
    });

    <% end %>

    <% if @game.opponent_pieces.split.include? '2' %>
    document.getElementById("opponentAdventureImage").src = '<%= image_url('icons/adventure.png')%>';
    $('img.opponentAdventureImage').attr("src", '<%= image_url('icons/adventure.png')%>');

        <% if !@game.user_pieces.split.include? '2' %>
            $('img.opponentStealAdventureImage').attr("src", '<%= image_url('icons/adventure.png')%>');
            $(function () {
                $("img.opponentStealAdventureImage").click(function () {
                    $.post('/steal_piece_settings', {chosen_category: 'adventure', bet_piece: piece_to_bet, type: 'steal'});
                });
            });
        <% end %>
    $("img.opponentAdventureImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'adventure'});
    });


    <% end %>

    <% if @game.opponent_pieces.split.include? '3' %>
    document.getElementById("opponentArcadeImage").src = '<%= image_url('icons/arcade.png')%>';
    $('img.opponentArcadeImage').attr("src", '<%= image_url('icons/arcade.png')%>');

    $("img.opponentArcadeImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'arcade'});
    });

    <% if !@game.user_pieces.split.include? '3' %>
        $('img.opponentStealArcadeImage').attr("src", '<%= image_url('icons/arcade.png')%>');
        $(function () {
            $("img.opponentStealArcadeImage").click(function () {
                $.post('/steal_piece_settings', {chosen_category: 'arcade', bet_piece: piece_to_bet, type: 'steal'});
            });
        });
    <% end %>


    <% end %>

    <% if @game.opponent_pieces.split.include? '4' %>
    document.getElementById("opponentFpsImage").src = '<%= image_url('icons/fps.png')%>';
    $('img.opponentFpsImage').attr("src", '<%= image_url('icons/fps.png')%>');
    $("img.opponentFpsImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'fps'});
    });

        <% if !@game.user_pieces.split.include? '4' %>
            $('img.opponentStealFpsImage').attr("src", '<%= image_url('icons/fps.png')%>');
            $(function () {
                $("img.opponentStealFpsImage").click(function () {
                    $.post('/steal_piece_settings', {chosen_category: 'fps', bet_piece: piece_to_bet, type: 'steal'});
                });
            });
        <% end %>

    <% end %>

    <% if @game.opponent_pieces.split.include? '5' %>
    document.getElementById("opponentRacingImage").src = '<%= image_url('icons/racing.png')%>';
    $('img.opponentRacingImage').attr("src", '<%= image_url('icons/racing.png')%>');
    $("img.opponentRacingImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'racing'});
    });

    <% if !@game.user_pieces.split.include? '5' %>
    $('img.opponentStealRacingImage').attr("src", '<%= image_url('icons/racing.png')%>');
    $(function () {
        $("img.opponentStealRacingImage").click(function () {
            $.post('/steal_piece_settings', {chosen_category: 'racing', bet_piece: piece_to_bet, type: 'steal'});
        });
    });
    <% end %>


    <% end %>

    <% if @game.opponent_pieces.split.include? '6' %>
    document.getElementById("opponentRolePlayingImage").src = '<%= image_url('icons/role-playing.png')%>';
    $('img.opponentStealRolePlayingImage').attr("src", '<%= image_url('icons/role-playing.png')%>');
        <% if !@game.user_pieces.split.include? '6' %>
            $('img.opponentRolePlayingImage').attr("src", '<%= image_url('icons/role-playing.png')%>');
            $(function () {
                $("img.opponentStealRolePlayingImage").click(function () {
                    $.post('/steal_piece_settings', {chosen_category: 'role-playing', bet_piece: piece_to_bet, type: 'steal'});
                });
            });
        <% end %>
    $("img.opponentRolePlayingImage").click(function () {
        $.post('/chosen_category', {chosen_category: 'role-playing'});
    });

    <% end %>
    wheelImageName = '<%= image_url('prizewheel.png') %>';
    begin();
    powerSelected(1);
</script>

<div class="modal fade" id="opponentStatsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <% if(@current_opponent.hide_email) %>
            <h4 class="modal-title" id="myModalLabel">Statistics and Achievements for Opponent</h4>
        <% else %>
            <h4 class="modal-title" id="myModalLabel">Statistics and Achievements for <%= @current_opponent.email %></h4>
        <% end %>

      </div>
      <div class="modal-body">
        <div role="tabpanel">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#oppstatistics" aria-controls="oppstatistics" role="tab" data-toggle="tab">Statistics</a></li>
            <li role="presentation"><a href="#oppachievements" aria-controls="oppachievements" role="tab" data-toggle="tab">Achievements</a></li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="oppstatistics">
              <table>
                <tr>
                  <td>
                    <img src='<%= image_url('icons/action.png') %>' width="50" height="50">
                    <% stat = Statistic.find_by email: @current_opponent.email %>
                    <% if stat.action_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.action_correct / stat.action_total) * 100 %>%
                    <% end %>
                  </td>
                  <td>
                    <img src='<%= image_url('icons/adventure.png') %>' width="50" height="50">
                    <% if stat.adventure_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.adventure_correct / stat.adventure_total) * 100 %>%
                    <% end %>
                  </td>
                  <td>
                    <img src='<%= image_url('icons/arcade.png') %>' width="50" height="50">
                    <% if stat.arcade_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.arcade_correct / stat.arcade_total) * 100 %>%
                    <% end %>
                  </td>
                </tr>
                <tr>
                  <td>
                    <img src='<%= image_url('icons/fps.png') %>' width="50" height="50">
                    <% if stat.fps_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.fps_correct / stat.fps_total) * 100 %>%
                    <% end %>
                  </td>
                  <td>
                    <img src='<%= image_url('icons/racing.png') %>' width="50" height="50">
                    <% if stat.racing_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.racing_correct / stat.racing_total) * 100 %>%
                    <% end %>
                  </td>
                  <td>
                    <img src='<%= image_url('icons/role-playing.png') %>' width="50" height="50">
                    <% if stat.role_playing_total == 0 %>
                        -%
                    <% else %>
                        <%= (stat.role_playing_correct / stat.role_playing_total) * 100 %>%
                    <% end %>
                  </td>
                </tr>
              </table>
              Wins: <%= Statistic.find_by(email: @current_opponent.email).wins %> ||
              Losses: <%= Statistic.find_by(email: @current_opponent.email).loses %>
              <br>
              Record against player:
              <br>
              Wins: <%= @won_games.size %> || Losses: <%= @lost_games.size %>
            </div>
            <div role="tabpanel" class="tab-pane" id="oppachievements">
              <% @current_opponent.badges.each do |badge| %>
                  <div class="row">
                    <img src='<%= image_url('achievements/' + badge.id.to_s + '.png') %>' width="50px"><%= badge.name %> : <%= badge.description %>
                  </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>